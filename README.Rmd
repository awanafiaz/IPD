---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>",
                      
  fig.path = "man/figures/README-", out.width = "100%")
```

# IPD: Inference on Predicted Data

<!-- badges: start -->
[![R-CMD-check](https://github.com/awanafiaz/IPD/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/awanafiaz/IPD/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

## <img src="man/figures/IPD_LOGO.png" align="right" height="200" style="float:right; height:200px;">

With the rapid advancement of artificial intelligence and machine learning (AI/ML), researchers from a wide range of disciplines increasingly use predictions from pre-trained algorithms as outcome variables in statistical analyses. However, reifying algorithmically-derived values as measured outcomes may lead to biased estimates and anti-conservative inference ([Wang et al., 2020](https://www.pnas.org/doi/suppl/10.1073/pnas.2001238117)). The statistical challenges encountered when drawing inference on predicted data (IPD) include: 

1. Understanding the relationship between predicted outcomes and their true unobserved counterparts
2. Quantifying the robustness of the AI/ML models to resampling or uncertainty about the training data
3. Appropriately propagating both bias and uncertainty from predictions into downstream inferential tasks

Several works have proposed methods for IPD, including post-prediction inference (PostPI) by [Wang et al., 2020](https://www.pnas.org/doi/suppl/10.1073/pnas.2001238117), prediction-powered inference (PPI) and PPI++ by [Angelopoulos et al., 2023a](https://www.science.org/doi/10.1126/science.adi6000) and [Angelopoulos et al., 2023b](https://arxiv.org/abs/2311.01453), and assumption-lean and data-adaptive post-prediction inference (POP-Inf) by [Miao et al., 2023](https://arxiv.org/abs/2311.14220). To enable researchers and practitioners interested in these state-of-the-art methods, we have developed `IPD`, a open-source `R` package that implements methods under the umbrella of IPD.

## Installation

You can install the development version of `IPD` from [GitHub](https://github.com/) with:

```{r, eval = F}
#-- Install devtools if it is not already installed

# install.packages("devtools")   

#-- Install the IPD package

devtools::install_github("awanafiaz/IPD")
```

## Usage

We provide a simple example to demonstrate the basic use of the functions included in `IPD`.

### Example Setup

1. Assume we have access to an algorithm \(f(X)\) that can predict our outcome of interest \(Y\).
2. Consider we have two datasets: a labeled dataset, \((Y_L, X_L, f(X))\), and an unlabeled dataset, \((X_u, f(X_U))\). The labeled set is typically smaller in size compared to the unlabeled set.
3. Our interest is in performing inference on \( H_0: \beta_1^* = 0 \) vs \( H_1: \beta_1^* \ne 0 \). Our inference model is:
   
$$Y_{val} = \beta_0^* + \beta_1^* X_{val} + \epsilon^*,$$

where \( \epsilon^* \) is normally distributed with mean 0 and variance 1. We do not observe \( Y_U \), but only the predicted \( \hat{Y}_U = f(X_U) \).

### Data Generation and Loading

```{r example}
#-- Load the IPD Library

library(IPD)

#-- Generate Example Data

set.seed(2023)

dat <- simdat(n = c(300, 300, 300), beta1 = 1)

head(dat)
```

### 1.1) PostPI Analytic Correction (Wang et al., 2020)

```{r postpi_analytic_ols}
#-- Specify the Formula

formula <- Y - Yhat ~ X1

#-- Fit the PostPI Analytic Correction

IPD::ipd(formula, 
         
  method = "postpi_analytic", model = "ols", data = dat, label_index = "set")
```

### 1.2) PostPI Bootstrap Correction (Wang et al., 2020)

```{r postpi_boot_ols}
#-- Fit the PostPI Bootstrap Correction

nboot <- 200

IPD::ipd(formula, 
         
  method = "postpi_boot", model = "ols", data = dat, label_index = "set")
```

### 2. Prediction-Powered Inference (PPI; Angelopoulos et al., 2023)

```{r ppi_ols}
#-- Fit the PPI Correction

IPD::ipd(formula, 
         
  method = "ppi", model = "ols", data = dat, label_index = "set")
```

### 3. PPI++ (Angelopoulos et al., 2023)

```{r ppi_plusplus}
#-- Fit the PPI++ Correction

IPD::ipd(formula, 
         
  method = "ppi_plusplus", model = "ols", data = dat, label_index = "set")
```

### 4. Assumption-Lean and Data-Adaptive Post-Prediction Inference (POP-Inf; Miao et al., 2023)

```{r popinf}
#-- Fit the POP-Inf Correction

IPD::ipd(formula, 
         
  method = "popinf", model = "ols", data = dat, label_index = "set")
```

## Vignette 

For additional details, we provide more use cases and examples in the package vignette:

```{r, eval = FALSE}
vignette("IPD")
```


## Feedback

For questions, comments, or any other feedback, please contact the developers.
